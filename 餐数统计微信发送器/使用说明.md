# 餐数统计微信发送器 - 增强版

## 功能说明
本工具用于分析简知轻食的扣餐表Excel文件，筛选出今日用餐人员，支持两种发送模式：
- **个人模式**：逐一发送个人微信消息告知用餐统计
- **群聊模式**：将统计报告汇总发送到指定微信群

## 主要特性
✨ **智能微信识别**：自动识别微信窗口，无需固定位置点击  
🎯 **精准输入框定位**：多种方法智能定位输入框位置  
🔄 **双发送模式**：支持个人消息和群聊统计报告  
⚙️ **群组选择**：可选择发送到特定群聊  
🧪 **完整测试功能**：提供搜索、发送、定位测试  
🛡️ **风控保护**：随机间隔发送，避免微信限制  

## 使用步骤

### 1. 准备工作
- 确保已安装Python 3.8+
- 确保微信已登录并保持打开状态
- 准备扣餐表Excel文件（包含"扣餐表"工作表）

### 2. 启动程序
- 双击 `启动餐数统计发送器.bat` 启动程序
- 程序会自动检查并安装所需依赖

### 3. 加载数据
- 拖拽Excel文件到程序界面，或点击"选择扣餐表文件..."按钮
- 设置目标日期（1-31号，默认为今天）
- 点击"分析数据"按钮

### 4. 发送设置

#### 基础设置
- **发送间隔**：设置消息发送间隔，避免微信风控（推荐1-2秒）

#### 发送方式
- **发送给个人**：逐一发送个人消息（默认）
- **发送到群聊**：发送汇总统计报告到群

#### 群聊设置（选择"发送到群聊"时启用）
- **群1名称**：第一个目标群的名称
- **群2名称**：第二个目标群的名称
- **勾选框**：选择要发送到哪些群

#### 测试模式
- **测试模式**：勾选后将所有消息发送到指定测试联系人/群
- **测试发送至**：测试模式下的目标（默认为"末"）

### 5. 测试功能
在正式发送前，建议先使用测试功能验证：
- **测试联系人搜索**：验证能否找到指定联系人
- **测试发送消息**：发送一条测试消息
- **测试输入框定位**：可视化显示输入框检测结果

### 6. 开始发送
- 点击"开始发送"按钮
- 程序会显示确认对话框，确认发送详情
- 程序会自动：
  - 智能识别并激活微信窗口
  - 精准搜索联系人/群聊
  - 智能定位输入框
  - 发送消息（个人或群聊统计）
  - 随机间隔避免风控

### 7. 停止发送
- 点击"停止发送"按钮，或按快捷键 `Ctrl+Shift+S`

## 消息模板

### 个人消息格式
```
亲爱的[姓名]，您好！

今天您已用餐，餐数统计如下：
📊 今日用餐：已记录
🍽️ 本月已用餐：[次数]次  
💰 剩余餐数：[次数]次

感谢您选择简知轻食！祝您用餐愉快！😊
```

### 群聊统计报告格式
```
📊 今日用餐统计报告 (2024-XX-XX)

用餐人数：X 人

1. 张三：已用5次，剩余15次
2. 李四：已用8次，剩余12次
...

💡 详细信息请查看餐数统计表
```

## 技术特性

### 智能微信识别
- 自动枚举所有窗口，智能匹配微信主窗口
- 支持多种微信版本和窗口类名
- 窗口激活验证，确保操作成功

### 精准输入框定位
1. **控件识别**：使用UI自动化控件精确定位
2. **窗口计算**：基于窗口尺寸动态计算位置
3. **智能点击**：多点尝试并验证点击效果
4. **可视化测试**：屏幕标记显示检测位置

### 发送模式对比
| 特性 | 个人模式 | 群聊模式 |
|------|----------|----------|
| 消息数量 | 每人一条 | 每群一条汇总 |
| 发送时间 | 较长 | 较短 |
| 信息详细度 | 个人详细 | 统计概览 |
| 适用场景 | 个人通知 | 群内公告 |

## 注意事项
1. **发送期间**请勿操作电脑，避免干扰自动化流程
2. **联系人姓名**确保微信联系人姓名与Excel表中的"会员姓名"一致
3. **群聊名称**确保群聊名称输入正确，区分大小写
4. **测试优先**建议先使用测试功能验证，再正式发送
5. **网络稳定**确保网络连接稳定，避免发送中断
6. **权限设置**程序需要控制鼠标键盘的权限

## 故障排除

### 常见问题
- **找不到微信窗口**：确认微信已打开并登录，尝试重启微信
- **找不到联系人**：检查联系人是否存在，姓名是否完全一致
- **输入框定位失败**：使用"测试输入框定位"功能查看检测结果
- **发送失败**：检查网络连接，确认微信状态正常

### 调试功能
- 使用测试功能逐项验证各个环节
- 查看程序日志了解详细错误信息
- 测试模式下先发送到安全目标

### 性能优化
- 关闭不必要的程序，释放系统资源
- 确保微信窗口完全可见，不被遮挡
- 调整发送间隔，平衡速度和稳定性

## 技术支持
如遇问题请联系技术支持，提供：
1. 详细错误信息截图
2. Excel文件样本（脱敏处理）
3. 微信版本和系统信息
4. 测试功能的执行结果

---
*餐数统计微信发送器 v2.0 - 智能发送，精准定位*